from orchestrator import build_orchestrator
from agents import AgentSwarm, MetaLearner
from memory import EvoMemory  # New import
from dotenv import load_dotenv

load_dotenv()

import os
import sys
import json

def main():
    goal = " ".join(sys.argv[1:]) or os.getenv("AF_GOAL") or "Design UI. Build backend API. Create DB schema. Implement code. Write unit tests."
    num_agents = int(os.getenv("AF_AGENTS", "2"))
    orch = build_orchestrator(num_agents=num_agents)
    results = orch.run_goal_sync(goal)
    print(json.dumps({"goal": goal, "results": results}, indent=2))

if __name__ == "__main__":
    main()

swarm = AgentSwarm(num_agents=2)
learner = MetaLearner(num_agents=2)
memory = EvoMemory()  # New memory module

# Test Orchestrator

# Test Healing
sample_output = "print('hello"  # Buggy

# Test Swarm
swarm_tasks = [
    # Task(id="t2", description="Write Python code for a web scraper", memory_scopes=[], budget=1000, tools=[], priority=1),
    # Task(id="t3", description="Review code for errors", memory_scopes=[], budget=1000, tools=[], priority=1),
]
results, mem_usage = swarm.parallel_process(swarm_tasks)
print(f"Swarm results: {results}\nMemory usage: {mem_usage}")

# Test Meta-Learning
print(f"Updated weights: {new_weights}")

# Test Memory
retrieved = memory.retrieve("task1")
print(f"Retrieved from memory: {retrieved}")

# Test Semantic Search
search_query = "web scraper code"
semantic_results = memory.semantic_search(search_query, top_k=1)
print(f"Semantic search results for '{search_query}': {semantic_results}")