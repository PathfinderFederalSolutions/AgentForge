apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: agentforge-mega-swarm-hpa
  namespace: agentforge-production
  labels:
    app.kubernetes.io/name: agentforge
    app.kubernetes.io/component: mega-swarm-autoscaler
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: agentforge-mega-swarm
  minReplicas: 100        # Minimum 100 replicas for million-scale base
  maxReplicas: 10000      # Maximum 10,000 replicas (100+ agents per replica)
  metrics:
  # Primary metric: Agent queue depth
  - type: Object
    object:
      metric:
        name: agentforge_agent_queue_depth
      target:
        type: AverageValue
        averageValue: "1000"  # Target 1000 queued agents per pod
      describedObject:
        apiVersion: v1
        kind: Service
        name: agentforge-mega-swarm
  
  # Secondary metric: Quantum coordination load
  - type: Object
    object:
      metric:
        name: agentforge_quantum_coordination_load
      target:
        type: AverageValue
        averageValue: "0.7"   # Target 70% coordination efficiency
      describedObject:
        apiVersion: v1
        kind: Service
        name: agentforge-quantum-scheduler
  
  # Tertiary metric: Neural mesh utilization
  - type: Object
    object:
      metric:
        name: agentforge_neural_mesh_utilization
      target:
        type: AverageValue
        averageValue: "0.8"   # Target 80% neural mesh utilization
      describedObject:
        apiVersion: v1
        kind: Service
        name: agentforge-neural-mesh
  
  # CPU utilization (safety metric)
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
  
  # Memory utilization (safety metric)
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 80
  
  # GPU utilization for AI workloads
  - type: Resource
    resource:
      name: nvidia.com/gpu
      target:
        type: Utilization
        averageUtilization: 75
  
  behavior:
    scaleDown:
      stabilizationWindowSeconds: 600  # Wait 10 minutes before scaling down
      policies:
      - type: Percent
        value: 5   # Scale down by at most 5% of current replicas
        periodSeconds: 60
      - type: Pods
        value: 50  # Or remove at most 50 pods
        periodSeconds: 60
      selectPolicy: Min  # Use the most conservative policy
    
    scaleUp:
      stabilizationWindowSeconds: 30   # Scale up quickly when load increases
      policies:
      - type: Percent
        value: 100  # Scale up by at most 100% of current replicas
        periodSeconds: 15
      - type: Pods
        value: 500  # Or add at most 500 pods
        periodSeconds: 15
      selectPolicy: Max  # Use the most aggressive policy for scale-up

---
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: agentforge-orchestrator-hpa
  namespace: agentforge-production
  labels:
    app.kubernetes.io/name: agentforge
    app.kubernetes.io/component: orchestrator-autoscaler
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: agentforge-orchestrator
  minReplicas: 50         # Minimum 50 orchestrator replicas
  maxReplicas: 1000       # Maximum 1000 orchestrator replicas
  metrics:
  # Primary metric: Job queue depth
  - type: Object
    object:
      metric:
        name: agentforge_job_queue_depth
      target:
        type: AverageValue
        averageValue: "500"   # Target 500 jobs per orchestrator
      describedObject:
        apiVersion: v1
        kind: Service
        name: agentforge-orchestrator
  
  # Secondary metric: Planning latency
  - type: Object
    object:
      metric:
        name: agentforge_planning_latency_p95
      target:
        type: AverageValue
        averageValue: "30"    # Target <30s planning latency
      describedObject:
        apiVersion: v1
        kind: Service
        name: agentforge-orchestrator
  
  # Resource utilization
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 80
  
  behavior:
    scaleDown:
      stabilizationWindowSeconds: 300
      policies:
      - type: Percent
        value: 10
        periodSeconds: 60
    scaleUp:
      stabilizationWindowSeconds: 60
      policies:
      - type: Percent
        value: 50
        periodSeconds: 30

---
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: agentforge-neural-mesh-hpa
  namespace: agentforge-production
  labels:
    app.kubernetes.io/name: agentforge
    app.kubernetes.io/component: neural-mesh-autoscaler
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: agentforge-neural-mesh
  minReplicas: 20         # Minimum 20 neural mesh replicas
  maxReplicas: 500        # Maximum 500 neural mesh replicas
  metrics:
  # Primary metric: Memory operations per second
  - type: Object
    object:
      metric:
        name: agentforge_memory_ops_per_second
      target:
        type: AverageValue
        averageValue: "10000"  # Target 10k ops/sec per replica
      describedObject:
        apiVersion: v1
        kind: Service
        name: agentforge-neural-mesh
  
  # Secondary metric: L4 cache hit ratio
  - type: Object
    object:
      metric:
        name: agentforge_l4_cache_hit_ratio
      target:
        type: AverageValue
        averageValue: "0.85"   # Target 85% cache hit ratio
      describedObject:
        apiVersion: v1
        kind: Service
        name: agentforge-neural-mesh
  
  # Resource utilization
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 75
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 85
  
  behavior:
    scaleDown:
      stabilizationWindowSeconds: 600  # Neural mesh needs stability
      policies:
      - type: Percent
        value: 5
        periodSeconds: 120
    scaleUp:
      stabilizationWindowSeconds: 120
      policies:
      - type: Percent
        value: 25
        periodSeconds: 60
